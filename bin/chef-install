#!/bin/bash

# install ruby and chef
rvm install ruby-1.8.7
rvm use ruby-1.8.7
gem install chef

# create git repo to push changes to the instance
repo=$(cat $EC2_GIT_BOOTSTRAP_PATH/chef-repo)
mkdir $HOME/.ssh
cp $EC2_GIT_BOOTSTRAP_PATH/chef-id_rsa $HOME/.ssh/id_rsa
chmod 400 $HOME/.ssh/id_rsa
export GIT_SSH=$HOME/bin/git-ssh-wrap.sh
git clone $repo chef-repo
exec $HOME/bin/kick
